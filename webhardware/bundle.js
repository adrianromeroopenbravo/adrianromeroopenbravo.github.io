!function(e){function t(t){for(var n,a,c=t[0],o=t[1],u=t[2],h=0,d=[];h<c.length;h++)a=c[h],Object.prototype.hasOwnProperty.call(i,a)&&i[a]&&d.push(i[a][0]),i[a]=0;for(n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n]);for(l&&l(t);d.length;)d.shift()();return s.push.apply(s,u||[]),r()}function r(){for(var e,t=0;t<s.length;t++){for(var r=s[t],n=!0,c=1;c<r.length;c++){var o=r[c];0!==i[o]&&(n=!1)}n&&(s.splice(t--,1),e=a(a.s=r[0]))}return e}var n={},i={1:0},s=[];function a(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,a),r.l=!0,r.exports}a.m=e,a.c=n,a.d=function(e,t,r){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)a.d(r,n,function(t){return e[t]}.bind(null,n));return r},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="./";var c=window.webpackJsonp=window.webpackJsonp||[],o=c.push.bind(c);c.push=t,c=c.slice();for(var u=0;u<c.length;u++)t(c[u]);var l=o;s.push([8,2,0]),r()}({7:function(e,t,r){},8:function(e,t,r){"use strict";r.r(t);var n=r(0),i=r.n(n),s=r(2),a=r.n(s);function c(e,t){const r=new Uint8Array(e.length+t.length);return r.set(e,0),r.set(t,e.byteLength),r}const o={encoderText:new TextEncoder,NEW_LINE:new Uint8Array([13,10]),PARTIAL_CUT_1:new Uint8Array([27,105]),CHAR_SIZE_0:new Uint8Array([29,33,0]),CHAR_SIZE_1:new Uint8Array([29,33,1]),CHAR_SIZE_2:new Uint8Array([29,33,48]),CHAR_SIZE_3:new Uint8Array([29,33,49]),BOLD_SET:new Uint8Array([27,69,1]),BOLD_RESET:new Uint8Array([27,69,0]),UNDERLINE_SET:new Uint8Array([27,45,1]),UNDERLINE_RESET:new Uint8Array([27,45,0]),CENTER_JUSTIFICATION:new Uint8Array([27,97,1]),LEFT_JUSTIFICATION:new Uint8Array([27,97,0]),RIGHT_JUSTIFICATION:new Uint8Array([27,97,2]),DRAWER_OPEN:new Uint8Array([27,112,0,50,-6])};class u{constructor(e){var t,r,n;n=void 0,(r="webdevice")in(t=this)?Object.defineProperty(t,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[r]=n,this.webdevice=e.createWebDevice()}connected(){return this.webdevice.connected()}async request(){await this.webdevice.request()}async print(e){const t=(new DOMParser).parseFromString(e,"application/xml");if("parsererror"===t.documentElement.nodeName)throw"Error while parsing XML template.";const r=await this.processDOM(t);r.length>0&&await this.webdevice.sendData(r)}async processDOM(e){for(let t of e.children)if("output"===t.nodeName)return await this.processOutput(t);return new Uint8Array}async processOutput(e){let t=new Uint8Array;for(let r of e.children)"ticket"===r.nodeName?t=c(t,await this.processTicket(r)):"opendrawer"===r.nodeName&&(t=c(t,o.DRAWER_OPEN));return t}async processTicket(e){let t=new Uint8Array;for(let r of e.children)"line"===r.nodeName&&(t=c(t,await this.processLine(r)),t=c(t,o.NEW_LINE));return t=c(t,o.NEW_LINE),t=c(t,o.NEW_LINE),t=c(t,o.NEW_LINE),t=c(t,o.NEW_LINE),t=c(t,o.PARTIAL_CUT_1)}async processLine(e){let t=new Uint8Array;const r=e.getAttribute("size");t=c(t,"1"===r?o.CHAR_SIZE_1:"2"===r?o.CHAR_SIZE_2:"3"===r?o.CHAR_SIZE_3:o.CHAR_SIZE_0);for(let r of e.children)if("text"===r.nodeName){const e=r.textContent;if(e){const n=r.getAttribute("bold"),i=r.getAttribute("underline");"true"===n&&(t=c(t,o.BOLD_SET)),"true"===i&&(t=c(t,o.UNDERLINE_SET)),t=c(t,o.encoderText.encode(e)),"true"===n&&(t=c(t,o.BOLD_RESET)),"true"===i&&(t=c(t,o.UNDERLINE_RESET))}}return t}}async function l(e,t,r){for(let n=0;n<r.length;n+=t)await e(r.slice(n,n+t))}function h(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class d{constructor(e){h(this,"printertype",void 0),h(this,"device",void 0),this.printertype=e,this.device=null,navigator.usb&&navigator.usb.addEventListener&&navigator.usb.addEventListener("disconnect",e=>{e.device===this.device&&this.onDisconnected()})}connected(){return null!==this.device}async request(){if(!navigator.usb||!navigator.usb.requestDevice)throw"USB not supported.";this.device=await navigator.usb.requestDevice({filters:[{vendorId:this.printertype.vendorId,productId:this.printertype.productId}]})}async sendData(e){if(!this.device)throw"Device is not connected.";try{await this.device.open(),console.log("entrando3"),await this.device.selectConfiguration(1),await this.device.claimInterface(0),await l(this.printChunk(),64,e),await this.device.close()}catch(e){throw this.onDisconnected(),e}}printChunk(){return async e=>{if(null===this.device)throw"device is null";await this.device.transferOut(1,e.buffer)}}onDisconnected(){this.device=null}}const v={name:"EPSON TM T88V",createWebDevice:()=>new d({vendorId:1208,productId:514})};function p(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class w{constructor(e){p(this,"printertype",void 0),p(this,"size",void 0),p(this,"device",void 0),p(this,"server",void 0),p(this,"service",void 0),p(this,"characteristic",void 0),this.printertype=e,this.size=this.printertype.buffersize,this.device=null,this.server=null,this.service=null,this.characteristic=null}connected(){return null!==this.device}async request(){if(!navigator.bluetooth||!navigator.bluetooth.requestDevice)return Promise.reject("Bluetooth not supported.");this.device=await navigator.bluetooth.requestDevice({filters:[{services:this.printertype.services}]})}async sendData(e){if(!this.device||!this.device.gatt)throw"Device is not connected.";try{this.characteristic?await l(this.printChunk(),this.size,e):(this.server=await this.device.gatt.connect(),this.service=await this.server.getPrimaryService(this.printertype.services[0]),this.characteristic=await this.service.getCharacteristic(this.printertype.characteristic),await l(this.printChunk(),this.size,e))}catch(e){throw this.onDisconnected(),e}}printChunk(){return async e=>{if(null===this.characteristic)throw"device is null";await this.characteristic.writeValue(e)}}onDisconnected(){this.device=null,this.server=null,this.service=null,this.characteristic=null}}const f={name:"Generic Bluetooth Receipt Printer",createWebDevice:()=>new w({services:["e7810a71-73ae-499d-8c15-faa9aef0c3f2"],characteristic:"bef8d6c9-9c21-4c9e-b632-bd58c1009f9f",buffersize:20})};function b(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class y extends n.Component{constructor(e){super(e),b(this,"usbwebprinter",void 0),b(this,"btwebprinter",void 0),this.state={text:'<?xml version="1.0" encoding="UTF-8"?>\n  <output>\n    <ticket>\n    <line>\n    <text>This is the first line</text>\n    </line>  \n    <line>\n    <text>This is the second line</text>\n    </line>  \n    </ticket>\n  </output>\n    '},this.usbwebprinter=new u(v),this.btwebprinter=new u(f)}async printText(e){e.connected()||await e.request(),await e.print(this.state.text)}async handleClickUSB(e){await this.printText(this.usbwebprinter),alert("Success")}async handleClickBT(e){await this.printText(this.btwebprinter),alert("Success")}updateText(e){this.setState({text:e.target.value})}render(){return i.a.createElement("div",null,i.a.createElement("h1",null,"Openbravo Web Hardware"),i.a.createElement("div",null,i.a.createElement("button",{onClick:e=>this.handleClickUSB(e)},"WebUSB print"),i.a.createElement("button",{onClick:e=>this.handleClickBT(e)},"WebBluetooth print")),i.a.createElement("div",null,i.a.createElement("textarea",{onChange:e=>this.updateText(e),rows:30,cols:60},this.state.text)))}}r(7);"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("./service-worker.js").catch(e=>{console.warn("SW registration failed: ",e)})}),a.a.render(i.a.createElement(y,null),document.getElementById("root"))}});
//# sourceMappingURL=bundle.js.map